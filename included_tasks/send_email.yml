---
# The playbook needs parameters:
# - send_to - email address (by default it will send emails to itself)
# - mail_subject - subject of the mail
# - mail_body - content of the mail
# - body_content_format - format of the content, can be either html or plain


- name: Checking some variables
  assert:
    that: "{{ item }}"
    msg: "Condition does met the requirements: {{ item }}"
  loop:
    - "mail_subject is defined"
    - "body_content_format is defined and body_content_format in [ 'plain', 'html' ]"
    - "mail_body is defined"


- name: Load credentials for sending emails (see below how they used)
  include_vars:
    file: files/li9-mail-creds.vault
    name: mail


- name: "Send email to {{ send_to | default(mail.notify_mail_from) }}. Subject: {{ mail_subject }}"
  mail:
    host: "{{ mail.notify_mail_host }}"
    port: "{{ mail.notify_mail_port }}"
    username: "{{ mail.notify_mail_username }}"
    password: "{{ mail.notify_mail_password }}"
    subject: "{{ mail_subject }}"
    to: "{{ send_to | default(mail.notify_mail_from) }}"
    bcc: "Dmitrii.Mostovshchikov@Li9.com"
    from: "{{ mail.notify_mail_from }}"
    subtype: "{{ body_content_format | default('plain') }}"
    body: "{{ mail_body }}"

