- name: Checking ssh credentials
  block:

    - name: Install sshpass package
      yum:
        name: sshpass
        state: present
      register: sshpass_install


    - name: Make sure that needed variables are there
      assert:
        that:
          - vmhostip is defined
          - student_name is defined
          - student_pass is defined
        fail_msg: "None or some of vhost, student_name, and/or student_pass variables defined"
        success_msg: "VM credentials are there"


    - name: Check a remote ssh password on a remote host
      shell: |
        sshpass -e ssh '{{ vmhostip }}' -l '{{ student_name }}' id
      environment:
        SSHPASS: '{{ student_pass }}'
      delegate_to: localhost

    - name: Uninstall sshpass
      yum:
        name: sshpass
        state: absent
      when: sshpass_install is changed

  delegate_to: localhost

