---
  - name:
    hosts: "{{ vmhostip }}"
    gather_facts: true
    tasks:
#        command: "echo {{ postcheckpwd }} | passwd {{ studentname }} --stdin"
#      - command: "curl -fsSL https://goss.rocks/install -o /root/install"
#      - command: "chmod +rx /root/install"
#      - command: "/root/install"

      - shell: w

      - name: Download installer of goss
        get_url:
          url: "https://goss.rocks/install"
          dest: "/root/install"
          force: yes

      - shell: "chmod +x /root/install"
      - shell: "/root/install"

      - name: copy main config file
        copy:
          dest: /root/goss.yaml
          src: "files/goss.yaml"

      - command: "goss validate --format documentation"
        args:
          chdir: /root
        register: resultsoutput

      - name: send an email with results
        mail:
          subject: "Test results"
          to: "{{ adminemailnotifications }}"
          from: Li9 Demo <do-not-reply@demo.li9.com>
          body: "{{ resultsoutput.stdout }}"

      - name: adding tower_host to our VM inventory
        tower_host:
          description: "test host for invent"
          name:  "{{ vmhostip }}"
          inventory: "{{ playbookvminventoryname }}"
          tower_verify_ssl: no
          state: absent
