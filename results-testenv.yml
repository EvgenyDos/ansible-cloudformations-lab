---
  - name:
    hosts: "{{ vmhostip }}"
    gather_facts: true
    tasks:
      - name: lets check results and drop user from system
        command: "echo {{ postcheckpwd }} | passwd {{ studentname }} --stdin"
      - command: "curl -fsSL https://goss.rocks/install -o /root/install"
      - command: "chmod +rx /root/install"
      - command: "/root/install"
      - name: copy main config file
        copy:
          dest: /root/goss.yaml
          src: "files/goss.yaml"

      - command: "goss validate --format documentation"
        args:
          chdir: /root
        register: resultsoutput

      - name: send an email with results
        mail:
          subject: "Test results"
          to: "{{ adminemailnotifications }}"
          from: Li9 Demo <do-not-reply@demo.li9.com>
          body: "{{ resultsoutput.stdout }}"
