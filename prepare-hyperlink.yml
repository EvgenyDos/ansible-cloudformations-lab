---
- hosts: localhost
#  connection: local
#  become_user: apache
  gather_facts: false
#  become_method: su
  tasks:

      - shell: "whoami && w"

      - name: generate rondom name
        set_fact: rondomname="{{ 99999999999999999999999 | random | to_uuid }}"

      - name: just create a file
        template:
          dest: /var/www/cgi-bin/{{ rondomname }}
          owner: apache
          group: apache
          mode: '0755'
          src: "templates/sgi-bin.j2"

      - debug:
          msg: "useremailnotifications={{  useremailnotifications  }}"

      - name: "save hyperlinkname for remove later"
        set_stats:
          data:
            removehyperlinkfromtower: "{{ rondomname }}"

      - name: press to link for exam start
        mail:
          subject: "youre exam is ready"
          to: "{{ useremailnotifications }}"
          from: Li9 Exam <do-not-reply@li9.com>
          body: "{{ lookup('template', 'templates/mailhyperlink.html.j2') }}"